<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=utf8" http-equiv="Content-Type">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="Start" href="index.html">
<link rel="previous" href="Attr_helper.html">
<link rel="next" href="CamlinternalMenhirLib.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of extensions" rel=Appendix href="index_extensions.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Compiler_libs" rel="Chapter" href="Compiler_libs.html">
<link title="Ast_helper" rel="Chapter" href="Ast_helper.html">
<link title="Ast_invariants" rel="Chapter" href="Ast_invariants.html">
<link title="Ast_iterator" rel="Chapter" href="Ast_iterator.html">
<link title="Ast_mapper" rel="Chapter" href="Ast_mapper.html">
<link title="Asttypes" rel="Chapter" href="Asttypes.html">
<link title="Attr_helper" rel="Chapter" href="Attr_helper.html">
<link title="Builtin_attributes" rel="Chapter" href="Builtin_attributes.html">
<link title="CamlinternalMenhirLib" rel="Chapter" href="CamlinternalMenhirLib.html">
<link title="Depend" rel="Chapter" href="Depend.html">
<link title="Docstrings" rel="Chapter" href="Docstrings.html">
<link title="Lexer" rel="Chapter" href="Lexer.html">
<link title="Location" rel="Chapter" href="Location.html">
<link title="Longident" rel="Chapter" href="Longident.html">
<link title="Parse" rel="Chapter" href="Parse.html">
<link title="Parser" rel="Chapter" href="Parser.html">
<link title="Parsetree" rel="Chapter" href="Parsetree.html">
<link title="Pprintast" rel="Chapter" href="Pprintast.html">
<link title="Printast" rel="Chapter" href="Printast.html">
<link title="Syntaxerr" rel="Chapter" href="Syntaxerr.html">
<link title="Unit_info" rel="Chapter" href="Unit_info.html">
<link title="Arg_helper" rel="Chapter" href="Arg_helper.html">
<link title="Binutils" rel="Chapter" href="Binutils.html">
<link title="Build_path_prefix_map" rel="Chapter" href="Build_path_prefix_map.html">
<link title="Ccomp" rel="Chapter" href="Ccomp.html">
<link title="Clflags" rel="Chapter" href="Clflags.html">
<link title="Compression" rel="Chapter" href="Compression.html">
<link title="Config" rel="Chapter" href="Config.html">
<link title="Config_boot" rel="Chapter" href="Config_boot.html">
<link title="Config_main" rel="Chapter" href="Config_main.html">
<link title="Consistbl" rel="Chapter" href="Consistbl.html">
<link title="Diffing" rel="Chapter" href="Diffing.html">
<link title="Diffing_with_keys" rel="Chapter" href="Diffing_with_keys.html">
<link title="Domainstate" rel="Chapter" href="Domainstate.html">
<link title="Format_doc" rel="Chapter" href="Format_doc.html">
<link title="Identifiable" rel="Chapter" href="Identifiable.html">
<link title="Int_replace_polymorphic_compare" rel="Chapter" href="Int_replace_polymorphic_compare.html">
<link title="Lazy_backtrack" rel="Chapter" href="Lazy_backtrack.html">
<link title="Linkdeps" rel="Chapter" href="Linkdeps.html">
<link title="Load_path" rel="Chapter" href="Load_path.html">
<link title="Local_store" rel="Chapter" href="Local_store.html">
<link title="Misc" rel="Chapter" href="Misc.html">
<link title="Numbers" rel="Chapter" href="Numbers.html">
<link title="Profile" rel="Chapter" href="Profile.html">
<link title="Strongly_connected_components" rel="Chapter" href="Strongly_connected_components.html">
<link title="Targetint" rel="Chapter" href="Targetint.html">
<link title="Terminfo" rel="Chapter" href="Terminfo.html">
<link title="Warnings" rel="Chapter" href="Warnings.html">
<link title="Pparse" rel="Chapter" href="Pparse.html"><link title="Attribute tracking for warning 53" rel="Section" href="#2_Attributetrackingforwarning53">
<link title="Helpers for alert and warning attributes" rel="Section" href="#2_Helpersforalertandwarningattributes">
<link title="Helpers for searching for particular attributes" rel="Section" href="#2_Helpersforsearchingforparticularattributes">
<link title="Warning 53 helpers for environment attributes" rel="Subsection" href="#3_Warning53helpersforenvironmentattributes">
<title>OCaml compiler library : Builtin_attributes</title>
</head>
<body>
<h1>Module <a href="type_Builtin_attributes.html">Builtin_attributes</a></h1>

<pre><span id="MODULEBuiltin_attributes"><span class="keyword">module</span> Builtin_attributes</span>: <code class="code"><span class="keyword">sig</span></code> <a href="Builtin_attributes.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info module top">
<div class="info-desc">
<p>Support for the builtin attributes:</p>

<ul>
<li>ocaml.alert</li>
<li>ocaml.boxed</li>
<li>ocaml.deprecated</li>
<li>ocaml.deprecated_mutable</li>
<li>ocaml.explicit_arity</li>
<li>ocaml.immediate</li>
<li>ocaml.immediate64</li>
<li>ocaml.inline</li>
<li>ocaml.inlined</li>
<li>ocaml.noalloc</li>
<li>ocaml.poll</li>
<li>ocaml.ppwarning</li>
<li>ocaml.specialise</li>
<li>ocaml.specialised</li>
<li>ocaml.tailcall</li>
<li>ocaml.tail_mod_cons</li>
<li>ocaml.unboxed</li>
<li>ocaml.untagged</li>
<li>ocaml.unrolled</li>
<li>ocaml.warnerror</li>
<li>ocaml.warning</li>
<li>ocaml.warn_on_literal_pattern</li>
</ul>
<p><b>Warning:</b> this module is unstable and part of
  <a href="Compiler_libs.html">compiler-libs</a>.</p>
</div>
</div>
<hr width="100%">
<h3 id="2_Attributetrackingforwarning53">Attribute tracking for warning 53</h3>
<pre><code><span id="TYPEcurrent_phase"><span class="keyword">type</span> <code class="type"></code>current_phase</span> = </code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTcurrent_phase.Parser"><span class="constructor">Parser</span></span></code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTcurrent_phase.Invariant_check"><span class="constructor">Invariant_check</span></span></code></td>

</tr></table>

<div class="info ">
<div class="info-desc">
<p><code class="code">register_attr</code> must be called on the locations of all attributes that
    should be tracked for the purpose of misplaced attribute warnings.  In
    particular, it should be called on all attributes that are present in the
    source program except those that are contained in the payload of another
    attribute (because these may be left behind by a ppx and intentionally
    ignored by the compiler).</p>

<p>The <code class="code">current_phase</code> argument indicates when this function is being called</p>
<ul>
<li>either when an attribute is created in the parser or when we see an
    attribute while running the check in the <code class="code"><span class="constructor">Ast_invariants</span></code> module.  This is
    used to ensure that we track only attributes from the final version of the
    parse tree: we skip adding attributes seen at parse time if we can see that
    a ppx will be run later, because the <code class="code"><span class="constructor">Ast_invariants</span></code> check is always run on
    the result of a ppx.</li>
</ul>
<p>Note that the <code class="code"><span class="constructor">Ast_invariants</span></code> check is also run on parse trees created from
    marshalled ast files if no ppx is being used, ensuring we don't miss
    attributes in that case.</p>
</div>
</div>


<pre><span id="VALregister_attr"><span class="keyword">val</span> register_attr</span> : <code class="type"><a href="Builtin_attributes.html#TYPEcurrent_phase">current_phase</a> -&gt; string <a href="Location.html#TYPEloc">Location.loc</a> -&gt; unit</code></pre>
<pre><span id="VALmark_payload_attrs_used"><span class="keyword">val</span> mark_payload_attrs_used</span> : <code class="type"><a href="Parsetree.html#TYPEpayload">Parsetree.payload</a> -&gt; unit</code></pre><div class="info ">
<div class="info-desc">
<p>Marks the attributes hiding in the payload of another attribute used, for
    the purposes of misplaced attribute warnings (see comment on
    <code class="code">current_phase</code> above).  In the parser, it's simplest to add these to
    the table and remove them later, rather than threading through state
    tracking whether we're in an attribute payload.</p>
</div>
</div>

<pre><span id="VALwarn_unused"><span class="keyword">val</span> warn_unused</span> : <code class="type">unit -&gt; unit</code></pre><div class="info ">
<div class="info-desc">
<p>Issue misplaced attribute warnings for all attributes created with
    <code class="code">mk_internal</code> but not yet marked used. Does nothing if compilation
    is stopped before lambda due to command-line flags.</p>
</div>
</div>
<h4 id="3_Warning53helpersforenvironmentattributes">Warning 53 helpers for environment attributes</h4>
<p>Some attributes, like deprecation markers, do not affect the compilation of
    the definition on which they appear, but rather result in warnings on future
    uses of that definition.  This is implemented by moving the raw attributes
    into the environment, where they will be noticed on future accesses.</p>

<p>To make misplaced attribute warnings work appropriately for these
    attributes, we mark them "used" when they are moved into the environment.
    This is done with the helper functions in this section.</p>

<pre><span id="VALmark_alert_used"><span class="keyword">val</span> mark_alert_used</span> : <code class="type"><a href="Parsetree.html#TYPEattribute">Parsetree.attribute</a> -&gt; unit</code></pre><div class="info ">
<div class="info-desc">
<p>Marks the attribute used for the purposes of misplaced attribute warnings if
    it is an alert.  Call this when moving things allowed to have alert
    attributes into the environment.</p>
</div>
</div>

<pre><span id="VALmark_alerts_used"><span class="keyword">val</span> mark_alerts_used</span> : <code class="type"><a href="Parsetree.html#TYPEattributes">Parsetree.attributes</a> -&gt; unit</code></pre><div class="info ">
<div class="info-desc">
<p>The same as <code class="code"><span class="constructor">List</span>.iter&nbsp;mark_alert_used</code>.</p>
</div>
</div>

<pre><span id="VALmark_warn_on_literal_pattern_used"><span class="keyword">val</span> mark_warn_on_literal_pattern_used</span> : <code class="type"><a href="Parsetree.html#TYPEattributes">Parsetree.attributes</a> -&gt; unit</code></pre><div class="info ">
<div class="info-desc">
<p>Marks "warn_on_literal_pattern" attributes used for the purposes of
    misplaced attribute warnings.  Call this when moving constructors into the
    environment.</p>
</div>
</div>

<pre><span id="VALmark_deprecated_mutable_used"><span class="keyword">val</span> mark_deprecated_mutable_used</span> : <code class="type"><a href="Parsetree.html#TYPEattributes">Parsetree.attributes</a> -&gt; unit</code></pre><div class="info ">
<div class="info-desc">
<p>Marks "deprecated_mutable" attributes used for the purposes of misplaced
    attribute warnings.  Call this when moving labels of mutable fields into the
    environment.</p>
</div>
</div>
<h3 id="2_Helpersforalertandwarningattributes">Helpers for alert and warning attributes</h3>
<pre><span id="VALcheck_alerts"><span class="keyword">val</span> check_alerts</span> : <code class="type"><a href="Location.html#TYPEt">Location.t</a> -&gt; <a href="Parsetree.html#TYPEattributes">Parsetree.attributes</a> -&gt; string -&gt; unit</code></pre>
<pre><span id="VALcheck_alerts_inclusion"><span class="keyword">val</span> check_alerts_inclusion</span> : <code class="type">def:<a href="Location.html#TYPEt">Location.t</a> -&gt;<br>       use:<a href="Location.html#TYPEt">Location.t</a> -&gt;<br>       <a href="Location.html#TYPEt">Location.t</a> -&gt; <a href="Parsetree.html#TYPEattributes">Parsetree.attributes</a> -&gt; <a href="Parsetree.html#TYPEattributes">Parsetree.attributes</a> -&gt; string -&gt; unit</code></pre>
<pre><span id="VALalerts_of_attrs"><span class="keyword">val</span> alerts_of_attrs</span> : <code class="type"><a href="Parsetree.html#TYPEattributes">Parsetree.attributes</a> -&gt; <a href="Misc.html#TYPEalerts">Misc.alerts</a></code></pre>
<pre><span id="VALalerts_of_sig"><span class="keyword">val</span> alerts_of_sig</span> : <code class="type">mark:bool -&gt; <a href="Parsetree.html#TYPEsignature">Parsetree.signature</a> -&gt; <a href="Misc.html#TYPEalerts">Misc.alerts</a></code></pre>
<pre><span id="VALalerts_of_str"><span class="keyword">val</span> alerts_of_str</span> : <code class="type">mark:bool -&gt; <a href="Parsetree.html#TYPEstructure">Parsetree.structure</a> -&gt; <a href="Misc.html#TYPEalerts">Misc.alerts</a></code></pre>
<pre><span id="VALcheck_deprecated_mutable"><span class="keyword">val</span> check_deprecated_mutable</span> : <code class="type"><a href="Location.html#TYPEt">Location.t</a> -&gt; <a href="Parsetree.html#TYPEattributes">Parsetree.attributes</a> -&gt; string -&gt; unit</code></pre>
<pre><span id="VALcheck_deprecated_mutable_inclusion"><span class="keyword">val</span> check_deprecated_mutable_inclusion</span> : <code class="type">def:<a href="Location.html#TYPEt">Location.t</a> -&gt;<br>       use:<a href="Location.html#TYPEt">Location.t</a> -&gt;<br>       <a href="Location.html#TYPEt">Location.t</a> -&gt; <a href="Parsetree.html#TYPEattributes">Parsetree.attributes</a> -&gt; <a href="Parsetree.html#TYPEattributes">Parsetree.attributes</a> -&gt; string -&gt; unit</code></pre>
<pre><span id="VALerror_of_extension"><span class="keyword">val</span> error_of_extension</span> : <code class="type"><a href="Parsetree.html#TYPEextension">Parsetree.extension</a> -&gt; <a href="Location.html#TYPEerror">Location.error</a></code></pre>
<pre><span id="VALwarning_attribute"><span class="keyword">val</span> warning_attribute</span> : <code class="type">?ppwarning:bool -&gt; <a href="Parsetree.html#TYPEattribute">Parsetree.attribute</a> -&gt; unit</code></pre><div class="info ">
<div class="info-desc">
<p>Apply warning settings from the specified attribute.
      "ocaml.warning"/"ocaml.warnerror" (and variants without the prefix) are
      processed and marked used for warning 53.  Other attributes are ignored.</p>

<p>Also implement ocaml.ppwarning (unless ~ppwarning:false is
      passed).</p>
</div>
</div>

<pre><span id="VALwarning_scope"><span class="keyword">val</span> warning_scope</span> : <code class="type">?ppwarning:bool -&gt; <a href="Parsetree.html#TYPEattributes">Parsetree.attributes</a> -&gt; (unit -&gt; 'a) -&gt; 'a</code></pre><div class="info ">
<div class="info-desc">
<p>Execute a function in a new scope for warning settings.  This
      means that the effect of any call to <code class="code">warning_attribute</code> during
      the execution of this function will be discarded after
      execution.</p>

<p>The function also takes a list of attributes which are processed
      with <code class="code">warning_attribute</code> in the fresh scope before the function
      is executed.</p>
</div>
</div>
<h3 id="2_Helpersforsearchingforparticularattributes">Helpers for searching for particular attributes</h3>
<pre><span id="VALhas_attribute"><span class="keyword">val</span> has_attribute</span> : <code class="type">string -&gt; <a href="Parsetree.html#TYPEattributes">Parsetree.attributes</a> -&gt; bool</code></pre><div class="info ">
<div class="info-desc">
<p><code class="code">has_attribute&nbsp;name&nbsp;attrs</code> is true if an attribute with name <code class="code">name</code> or
    <code class="code"><span class="string">"ocaml."</span>&nbsp;^&nbsp;name</code> is present in <code class="code">attrs</code>.  It marks that attribute used for
    the purposes of misplaced attribute warnings.</p>
</div>
</div>

<pre><code><span id="TYPEattr_action"><span class="keyword">type</span> <code class="type"></code>attr_action</span> = </code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTattr_action.Mark_used_only"><span class="constructor">Mark_used_only</span></span></code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTattr_action.Return"><span class="constructor">Return</span></span></code></td>

</tr></table>

<div class="info ">
<div class="info-desc">
<p><code class="code">select_attributes&nbsp;actions&nbsp;attrs</code> finds the elements of <code class="code">attrs</code> that appear
    in <code class="code">actions</code> and either returns them or just marks them used, according to
    the corresponding <code class="code">attr_action</code>.</p>

<p>Each element <code class="code">(nm,&nbsp;action)</code> of the <code class="code">actions</code> list is an attribute along with
    an <code class="code">attr_action</code> specifying what to do with that attribute.  The action is
    used to accommodate different compiler configurations.  If an attribute is
    used only in some compiler configurations, it's important that we still look
    for it and mark it used when compiling with other configurations.
    Otherwise, we would issue spurious misplaced attribute warnings.</p>
</div>
</div>


<pre><span id="VALselect_attributes"><span class="keyword">val</span> select_attributes</span> : <code class="type">(string * <a href="Builtin_attributes.html#TYPEattr_action">attr_action</a>) list -&gt;<br>       <a href="Parsetree.html#TYPEattributes">Parsetree.attributes</a> -&gt; <a href="Parsetree.html#TYPEattributes">Parsetree.attributes</a></code></pre>
<pre><span id="VALattr_equals_builtin"><span class="keyword">val</span> attr_equals_builtin</span> : <code class="type"><a href="Parsetree.html#TYPEattribute">Parsetree.attribute</a> -&gt; string -&gt; bool</code></pre><div class="info ">
<div class="info-desc">
<p><code class="code">attr_equals_builtin&nbsp;attr&nbsp;s</code> is true if the name of the attribute is <code class="code">s</code> or
    <code class="code"><span class="string">"ocaml."</span>&nbsp;^&nbsp;s</code>.  This is useful for manually inspecting attribute names, but
    note that doing so will not result in marking the attribute used for the
    purpose of warning 53, so it is usually preferable to use <code class="code">has_attribute</code>
    or <code class="code">select_attributes</code>.</p>
</div>
</div>

<pre><span id="VALwarn_on_literal_pattern"><span class="keyword">val</span> warn_on_literal_pattern</span> : <code class="type"><a href="Parsetree.html#TYPEattributes">Parsetree.attributes</a> -&gt; bool</code></pre>
<pre><span id="VALexplicit_arity"><span class="keyword">val</span> explicit_arity</span> : <code class="type"><a href="Parsetree.html#TYPEattributes">Parsetree.attributes</a> -&gt; bool</code></pre>
<pre><span id="VALimmediate"><span class="keyword">val</span> immediate</span> : <code class="type"><a href="Parsetree.html#TYPEattributes">Parsetree.attributes</a> -&gt; bool</code></pre>
<pre><span id="VALimmediate64"><span class="keyword">val</span> immediate64</span> : <code class="type"><a href="Parsetree.html#TYPEattributes">Parsetree.attributes</a> -&gt; bool</code></pre>
<pre><span id="VALhas_unboxed"><span class="keyword">val</span> has_unboxed</span> : <code class="type"><a href="Parsetree.html#TYPEattributes">Parsetree.attributes</a> -&gt; bool</code></pre>
<pre><span id="VALhas_boxed"><span class="keyword">val</span> has_boxed</span> : <code class="type"><a href="Parsetree.html#TYPEattributes">Parsetree.attributes</a> -&gt; bool</code></pre></body></html>
